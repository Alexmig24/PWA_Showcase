<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESPE Store</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-amber.min.css" />
  <link rel="stylesheet" href="src/css/app.css">
  <link rel="manifest" href="./manifest.webmanifest.json">
  <link rel="icon" type="image/png" href="./src/assets/icons/icon-128x128.png">
  <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script defer src="src/js/app.js"></script>
</head>
<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    
    <!-- HEADER -->
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">ESPE Store</span>
        <div class="mdl-layout-spacer"></div>
      </div>
    </header>

    <!-- MENÚ LATERAL -->
    <div class="mdl-layout__drawer">
      <nav class="mdl-navigation">
        <a class="mdl-navigation__link" href="">
          <i class="material-icons mdl-color-text--primary">home</i>
          Inicio
        </a>
        <a class="mdl-navigation__link" href="">
          <i class="material-icons mdl-color-text--primary">shopping_cart</i>
          Productos
        </a>
        <div class="mdl-navigation__link app--install" id="banner-install">
          <i class="material-icons mdl-color-text--primary">app_settings_alt</i>
          Instalar App
        </div>
      </nav>
    </div>
    
    <!-- CONTENIDO PRINCIPAL -->
    <main class="mdl-layout__content">
      <div class="page-content">

        <!-- Modal para nuevo producto -->
        <div id="add-product-section" class="add-product-modal">
          <div class="add-product-content mdl-card mdl-shadow--8dp">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">Nuevo Producto</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input class="mdl-textfield__input" type="text" id="product-title">
                <label class="mdl-textfield__label" for="product-title">Nombre del Producto</label>
              </div>
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <textarea class="mdl-textfield__input" id="product-description" rows="3"></textarea>
                <label class="mdl-textfield__label" for="product-description">Descripción</label>
              </div>
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input class="mdl-textfield__input" type="text" id="product-price">
                <label class="mdl-textfield__label" for="product-price">Precio (ej: $25.99)</label>
              </div>
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                <input class="mdl-textfield__input" type="url" id="product-image">
                <label class="mdl-textfield__label" for="product-image">URL de la imagen (opcional)</label>
              </div>
              <label class="mdl-checkbox mdl-js-checkbox mdl-checkbox--ripple-effect" for="product-available">
                <input type="checkbox" id="product-available" class="mdl-checkbox__input" checked>
                <span class="mdl-checkbox__label">Producto disponible</span>
              </label>
              <br><br>
              <label class="mdl-radio mdl-js-radio mdl-radio--ripple-effect" for="theme-green">
                <input type="radio" id="theme-green" class="mdl-radio__button" name="button-theme" value="green" checked>
                <span class="mdl-radio__label">Botón Verde</span>
              </label>
              <br>
              <label class="mdl-radio mdl-js-radio mdl-radio--ripple-effect" for="theme-yellow">
                <input type="radio" id="theme-yellow" class="mdl-radio__button" name="button-theme" value="yellow">
                <span class="mdl-radio__label">Botón Amarillo</span>
              </label>
            </div>
            <div class="mdl-card__actions mdl-card--border">
              <button id="btn-save-product" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                Guardar
              </button>
              <button id="btn-cancel-product" class="mdl-button mdl-js-button mdl-button--raised">
                Cancelar
              </button>
            </div>
          </div>
        </div>
        
        <!-- Lista de productos -->
        <div id="products-container" class="products-grid"></div>
        
        <!-- Mensaje vacío -->
        <div id="empty-products" class="empty-products-message" style="display:none;">
          <i class="material-icons" style="font-size:48px;">shopping_bag</i>
          <p>No hay productos aún. ¡Agrega tu primer producto!</p>
        </div>
      </div>
      
      <!-- Botón flotante para nuevo producto -->
      <button id="btn-add-product" class="add-product-fab mdl-button mdl-js-button mdl-button--fab mdl-button--colored">
        <i class="material-icons">add_shopping_cart</i>
      </button>
    </main>
  </div>

  <script>
    let productsData = [];

    // Función para mostrar toast
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Función para crear una tarjeta de producto
    function createProductCard(product, index) {
      const card = document.createElement('div');
      card.className = 'product-card';
      
      const statusClass = product.status === 'Disponible' ? 'disponible' : 'sin-stock';
      const buttonTheme = product.buttonTheme || 'green';
      const isDisabled = product.status !== 'Disponible';
      
      card.innerHTML = `
        ${product.imageUrl ? 
          `<img src="${product.imageUrl}" alt="${product.title}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
           <div class="product-image" style="display:none;">
             <i class="material-icons">image</i>
           </div>` :
          `<div class="product-image">
             <i class="material-icons">image</i>
           </div>`
        }
        <div class="product-content">
          <h3 class="product-title">${product.title}</h3>
          <p class="product-description">${product.description}</p>
          <div class="product-price">${product.price}</div>
          <div class="product-status ${statusClass}">${product.status}</div>
          <button 
            class="product-button ${buttonTheme}" 
            ${isDisabled ? 'disabled' : ''}
            onclick="handleAddToCart(${index})"
          >
            ${isDisabled ? 'Sin Stock' : 'Agregar al Carrito'}
          </button>
        </div>
      `;
      
      return card;
    }

    // Función para renderizar productos
    function renderProducts(productsList) {
      const container = document.getElementById("products-container");
      const emptyMessage = document.getElementById("empty-products");

      container.innerHTML = "";

      if (!productsList.length) {
        emptyMessage.style.display = "block";
        return;
      }

      emptyMessage.style.display = "none";

      productsList.forEach((product, index) => {
        const productCard = createProductCard(product, index);
        container.appendChild(productCard);
      });
    }

    // Función para manejar agregar al carrito
    function handleAddToCart(index) {
      const product = productsData[index];
      
      if (product.status !== "Disponible") {
        showToast(`${product.title} está fuera de stock`, 'error');
        return;
      }
      
      console.log('Producto agregado:', product);
      showToast(`${product.title} agregado al carrito!`, 'success');
      
      // Simular guardar en carrito
      saveToCart(product);
    }

    // Función para guardar en carrito
    function saveToCart(product) {
      try {
        let cart = JSON.parse(localStorage.getItem('espe-cart') || '[]');
        
        const existingIndex = cart.findIndex(item => item.title === product.title);
        
        if (existingIndex >= 0) {
          cart[existingIndex].quantity = (cart[existingIndex].quantity || 1) + 1;
        } else {
          cart.push({ ...product, quantity: 1, addedAt: new Date().toISOString() });
        }
        
        localStorage.setItem('espe-cart', JSON.stringify(cart));
        console.log('Carrito actualizado:', cart);
      } catch (error) {
        console.error('Error al guardar en el carrito:', error);
      }
    }

    // Función para cargar productos
    function loadProducts() {
      // Datos de ejemplo si no hay productos
      if (productsData.length === 0) {
        productsData = [
          {
            title: "Laptop Gaming",
            description: "Potente laptop para gaming con gráficos de alta calidad",
            price: "$999.99",
            status: "Disponible",
            buttonTheme: "green",
            imageUrl: "https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=400"
          },
          {
            title: "Mouse Inalámbrico",
            description: "Mouse ergonómico con conectividad Bluetooth",
            price: "$29.99",
            status: "Sin stock",
            buttonTheme: "yellow"
          }
        ];
      }
      
      renderProducts(productsData);
    }

    // Event listeners cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar productos iniciales
      loadProducts();

      // Botón para abrir modal
      const btnAddProduct = document.getElementById('btn-add-product');
      const modal = document.getElementById('add-product-section');
      const btnSave = document.getElementById('btn-save-product');
      const btnCancel = document.getElementById('btn-cancel-product');

      // Abrir modal
      btnAddProduct.addEventListener('click', () => {
        modal.classList.add('show');
        // Re-inicializar componentes MDL del modal
        setTimeout(() => {
          componentHandler.upgradeDom();
        }, 100);
      });

      // Cerrar modal
      btnCancel.addEventListener('click', () => {
        modal.classList.remove('show');
        clearForm();
      });

      // Cerrar modal al hacer clic fuera
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('show');
          clearForm();
        }
      });

      // Guardar producto
      btnSave.addEventListener('click', () => {
        const title = document.getElementById('product-title').value.trim();
        const description = document.getElementById('product-description').value.trim();
        const price = document.getElementById('product-price').value.trim();
        const imageUrl = document.getElementById('product-image').value.trim();
        const available = document.getElementById('product-available').checked;
        const buttonTheme = document.querySelector('input[name="button-theme"]:checked').value;

        if (!title || !description || !price) {
          showToast('Por favor complete todos los campos requeridos', 'error');
          return;
        }

        const newProduct = {
          title,
          description,
          price,
          imageUrl: imageUrl || '',
          status: available ? 'Disponible' : 'Sin stock',
          buttonTheme
        };

        productsData.push(newProduct);
        renderProducts(productsData);
        modal.classList.remove('show');
        clearForm();
        showToast('Producto agregado exitosamente', 'success');
      });

      // Función para limpiar formulario
      function clearForm() {
        document.getElementById('product-title').value = '';
        document.getElementById('product-description').value = '';
        document.getElementById('product-price').value = '';
        document.getElementById('product-image').value = '';
        document.getElementById('product-available').checked = true;
        document.getElementById('theme-green').checked = true;
        
        // Limpiar estados de MDL
        document.querySelectorAll('.mdl-textfield').forEach(field => {
          field.classList.remove('is-dirty', 'is-focused');
        });
      }
    });
  </script>
</body>
</html>